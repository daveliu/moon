<% form_for [@project, @message], :html => {:id => 'message_form', :multipart => true} do |f| -%>
	<div id="post_form_container">
		<div class="main_attributes">
			<div class="inner">
				<div class="input">
					<h2 class="text_input">Title</h2>
  				<%= f.text_field :title, :class => "message_title", :size => "50", :style => "width:920px;" %>
				</div>
				<div class="input">
					<h2 class="text_input">
						分类
						<%= f.select :category_id, current_project.categories.collect {|c| [c.name, c.id] }, {:include_blank => "没有分类"} %>
					</h2>
				</div>
				<%= f.text_area :body, :style => "height: 150px; width: 920px;", :cols => "40"  %>
			</div>
		</div>	
	</div>	
	<div class="attachments_option message_option">
		<img class="paperclip" src="/images/attachment_block_icon.gif" alt="Attachment_block_icon"/>
		<div class="indented">
				<h2>Attach files
				  <span class="filesize_limit">(each file should be under 100MB)</span>
				</h2>
				<div class="pending_attachments">                                    
					<% @message.assets.each do |asset| %>
						<%=  render :partial => 'assets/asset', :locals => {:asset => asset} %>
					<% end -%>
				</div>
				<div id="attachment_fields">
					<div class="pending_attachments">
					</div>                           
					<div class="file_selectors">
						<p class="offscreen"></p>
						<p class="template">            
							<input id="" class="file_selectors" type="file" size="30" onchange="PendingAttachments.add(this, 'attachment_fields')" name="message[assets_attributes][0][data]"/>
						</p>  
					</div>
				</div>	  
		</div>
	</div>                                         
	<div class="milestone_option message_option">
		<h2>和某个milestone关联吗?</h2>
		<p>
			<%= f.select :milestone_id, current_project.milestones.collect {|milestone|[milestone.title, milestone.id]},  {:include_blank => "没有milestone"} %>
		</p>
	</div>
	<div class="subscribers message_option">
		<div class="notification_header">
			<h2>Subscribe people to receive email notifications</h2>
			<p>  The people you select will get an email when you post this message.
			<br/>
			They'll also be notified by email every time a comment is added.
			</p>
		</div>
		<div class="indented">
			<div id="NotifyBlock" class="notify">
				<table class="emailnotification">
					<tbody id="email_notification_block" class="multiple firm">
						<tr>
							<td colspan="3">
								<p>
									<input id="notify_all" type="checkbox" value="1" name="notify_all"/>
									<label for="notify_all">
									<strong>All of beibeigan</strong>    
								</label>
								</p>
							</td>
						</tr>
						<tr class='checkbox_row'>  
							
							<% f.fields_for :notifies do |notify_form| %>                                                
								<td>
									<% user = notify_form.object.user %>	
									<% options = (notify_form.object.new_record? ? {:checked => false} : {}) %>  
									<p>
										<%= notify_form.check_box :user_id, options, user.id  %>
										<label for="notify-<%= user.id %>"> <%= user.login %> </label>
									</p>
								</td>	
							<% end -%>
						</tr>      
					</tbody>
				</table>                
				<script type="text/javascript">
				//<![CDATA[
				 SelectAllCheckbox.initialize("notify_all");
				//]]>
				</script>
		</div>
		</div>
	</div>
<% end -%>