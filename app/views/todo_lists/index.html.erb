<div class="page_header">
	<div class="page_header_links">
		<span id="normal_list_controls" style="">
		<a id="reorder_lists_link" class="admin" href="#">Reorder lists</a>
		</span>
	</div>
	<h1>To-do lists</h1>
</div>
<div class="innercol">
	<div class="page content">
		<div id="widgets" class="widget_parent lists" style="position: relative;">
			<% @todo_lists.each do |list| %>
				<div id="<%= dom_id(list) %>" class="widget page_widget list_wrapper" style="position: relative;">
					<div class="hover_container widget_content list">
						<div class="list_title">    
							<h2>
								<span id="list_6347262_name" class="hover_target">
									<a href="/projects/3380838/todo_lists/6347262">miao</a>
								</span>
							</h2>
						</div>    
						<% if list.milestone %>
							<p class="listdesc">
								Related milestone:
								<%= link_to "#{list.milestone.title} - #{list.milestone.due}", milestone_path(list.milestone), :class => "attached_milestone" %>
							</p>
						<% end -%>	
						<div class="items_wrapper">  
							<div id="list_<%= list.id %>_items" class="items widget_parent" style="position: relative;">        
								<% list.todos.by_state("pending").each do |todo| %>
									<%= render :partial => "todos/todo", :locals => {:todo => todo} %>
							  <% end -%>	
							</div>	
						</div>
						<div class="add_item">      
							<div id="list_<%= list.id %>_new_item" class="widget list_widget item_wrapper" style="display: none;">       
								<% form_for Todo.new, :url => todo_list_todos_path(list), :html => {
									:onsubmit => "$.ajax({
								    type:'POST', url: $(this).attr('action'), dataType: 'script', data: $(this).serialize()});return false;"
								} do |todo_form| -%>
								  <p>
										Enter a to-do item<br/>
										<textarea id="new_content_<%= list.id %>" class="new_item_field" rows="3" name="todo[body]" cols="40"></textarea>
									</p>                                                       
									<p>
										Who's responsible?<br/>
										<%= todo_form.select :receiver_id, User.all.collect {|u| [u.login, u.id]} %>
									</p>   
									<p class="submit">
										<input type="submit" value="Add this item"/>
										<span>or</span>
										<a class="admin" onclick="$('#list_<%= list.id %>_new_item').hide();$('#link_to_add_child_list_<%= list.id %>').show(); return false;" href="#">I'm done adding items</a>
									</p>
								<% end -%>
							</div>	
							<div id="link_to_add_child_list_<%= list.id %>" style="">
								<a  class="admin" onclick="$('#list_<%= list.id %>_new_item').show();$('#link_to_add_child_list_<%= list.id %>').hide();return false;" href="#">Add an item</a>
							</div>
						</div>
						<div id="list_<%= list.id %>_completed_items" class="done">
							<% list.todos.by_state("completed").each do |todo| %>
								<%= render :partial => "todos/completed_todo", :locals => {:todo => todo} %>
						  <% end -%>
						</div>
					</div>
				</div>                      
			<% end -%>
		</div>
	</div>
</div>

<% content_for :side do  %>
	<div class="button_to_add_new">
		<a class="image" href="todo_lists/new">
			<img src="http://asset1.projectpath.com/images/new_to-do_list.gif?1245383866" alt="New to-do list"/>
		</a>
	</div>
	<div id="sidebar">
		<div class="indent">
			<form style="margin: 0pt; padding: 0pt;" method="get" action="/projects/3380838/todo_lists">
				<p>
					Show to-dos assigned to:
					<br/>
					<select id="responsible_party" onchange="this.up('form').submit()" name="responsible_party">
					</select>
				</p>
			</form>
		</div>
		<div class="indent">    
			<h2>Current to-do lists</h2>
			<ul id="menu_list">
				<li id="menu_list_6347262">
				</li>
				<li id="menu_list_6347244">
				<a id="menu_list_name_6347244" href="#list_6347244">about test</a>
				</li> 
			</ul>
		</div>	
	</div>	
<% end -%>	